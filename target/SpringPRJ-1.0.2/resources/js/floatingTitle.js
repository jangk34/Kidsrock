(function(){var floatingPos=[];var isSettingComplete=false;var $unitTitles=$(".unit-title");var $floatingTitle=$(".floating-title");var STICKED_TITLE_HEIGHT=28;var HEADER_HEIGHT=45;var END_PADDING=100;var imgHeight;function setFloatingPos(){$.each($unitTitles,function(idx,val){var $title=$(val);var startPos=$title.offset().top+$title.height()-HEADER_HEIGHT;var currentImgHeight=$title.next().find("img").height();if(idx!==0&&currentImgHeight!==imgHeight){var prevUnitProdNum=parseInt($floatingTitle.eq(idx-
1).find(".count-style").text().split("/")[1],10);startPos+=(imgHeight-currentImgHeight)*prevUnitProdNum}var endPos=startPos+$title.next().outerHeight(true)-END_PADDING;floatingPos.push({start:startPos,end:endPos})})}function setListPos(){$unitTitles.each(function(idx,val){var deals=$(val).next().find("li");var dealTopPoses=[];var currentTop=floatingPos[idx].start;dealTopPoses.push(currentTop);var currentImgHeight=$(val).next().find("img").height();var isFixed=true;if(currentImgHeight!==imgHeight)isFixed=
false;for(var i=1;i<deals.size();i++){currentTop+=deals.eq(i).outerHeight(true);if(!isFixed)currentTop+=imgHeight-currentImgHeight;dealTopPoses.push(currentTop-STICKED_TITLE_HEIGHT)}floatingPos[idx]["dealsPos"]=dealTopPoses})}$window.on("floatingTitle",function(){if($unitTitles.size()===0||isSettingComplete)return;isSettingComplete=true;imgHeight=Math.floor(($document.width()-2)*140/300);setTimeout(activeFloatingTitle,500)});function activeFloatingTitle(){var unitPoses;var currentPageNum;setFloatingPos();
setListPos();function drawView(){var scrollPos=window.pageYOffset;var $on;for(var i=0,len=floatingPos.length;i<len;i++)if(floatingPos[i].start<scrollPos&&scrollPos<=floatingPos[i].end){$on=$floatingTitle.eq(i);break}if(!!$on){$floatingTitle.hide();$on.show();unitPoses=floatingPos[$on.index(".floating-title")].dealsPos;currentPageNum=unitPoses.indexOf(Math.max.apply(Math,unitPoses.filter(function(ele){return ele<scrollPos})))+1;if(currentPageNum!==parseInt($on.find(".current-count").text(),10))$on.find(".current-count").text(currentPageNum)}else $floatingTitle.hide()}
$document.on("scroll",$.throttle(100,drawView))}})();